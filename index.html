<!DOCTYPE html>

<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Op-Art Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

```
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
    }
    
    .main-container {
        max-width: 1400px;
        margin: 0 auto;
    }
    
    .header {
        background: rgba(255, 255, 255, 0.95);
        padding: 20px 30px;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        margin-bottom: 20px;
    }
    
    h1 {
        text-align: center;
        color: #333;
        font-size: 2.5em;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        margin-bottom: 10px;
    }
    
    .subtitle {
        text-align: center;
        color: #666;
        font-size: 1em;
    }
    
    .workspace {
        display: grid;
        grid-template-columns: 350px 1fr;
        gap: 20px;
    }
    
    .controls-panel {
        background: rgba(255, 255, 255, 0.95);
        padding: 20px;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        max-height: calc(100vh - 140px);
        overflow-y: auto;
    }
    
    .canvas-area {
        background: rgba(255, 255, 255, 0.95);
        padding: 20px;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        display: flex;
        flex-direction: column;
    }
    
    .control-section {
        margin-bottom: 25px;
        padding-bottom: 25px;
        border-bottom: 1px solid #eee;
    }
    
    .control-section:last-child {
        border-bottom: none;
    }
    
    .section-title {
        font-weight: bold;
        color: #333;
        font-size: 1.1em;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .section-icon {
        width: 24px;
        height: 24px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 5px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 14px;
    }
    
    .control-group {
        margin-bottom: 15px;
    }
    
    label {
        display: block;
        font-weight: 500;
        color: #555;
        font-size: 0.9em;
        margin-bottom: 8px;
    }
    
    input[type="file"] {
        width: 100%;
        padding: 10px;
        border: 2px dashed #ddd;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s;
        background: #fafafa;
    }
    
    input[type="file"]:hover {
        border-color: #667eea;
        background: #f5f5ff;
    }
    
    select {
        width: 100%;
        padding: 10px;
        border: 2px solid #ddd;
        border-radius: 8px;
        font-size: 0.9em;
        background: white;
        cursor: pointer;
        transition: all 0.3s;
    }
    
    select:focus {
        border-color: #667eea;
        outline: none;
    }
    
    input[type="range"] {
        width: 100%;
        cursor: pointer;
        margin-top: 5px;
    }
    
    input[type="color"] {
        width: 100%;
        height: 40px;
        border: 2px solid #ddd;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s;
    }
    
    input[type="color"]:hover {
        border-color: #667eea;
    }
    
    input[type="checkbox"] {
        width: 20px;
        height: 20px;
        cursor: pointer;
        margin-right: 10px;
    }
    
    .checkbox-label {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
    }
    
    .slider-container {
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .slider-value {
        min-width: 45px;
        text-align: center;
        font-size: 0.9em;
        color: #666;
        background: #f5f5f5;
        padding: 5px;
        border-radius: 5px;
    }
    
    .button-group {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
        margin-top: 10px;
    }
    
    button {
        padding: 12px 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 0.95em;
        font-weight: 600;
        transition: all 0.3s;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    button:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }
    
    button:active {
        transform: translateY(0);
    }
    
    button:disabled {
        background: #ccc;
        cursor: not-allowed;
        transform: none;
    }
    
    .primary-button {
        grid-column: 1 / -1;
    }
    
    .secondary-button {
        background: #6c757d;
    }
    
    .danger-button {
        background: #dc3545;
    }
    
    #canvas-container {
        flex: 1;
        display: flex;
        justify-content: center;
        align-items: center;
        background: #fafafa;
        border: 3px dashed #ddd;
        border-radius: 10px;
        padding: 20px;
        min-height: 500px;
        position: relative;
    }
    
    .empty-state {
        text-align: center;
        color: #999;
    }
    
    .empty-state-icon {
        font-size: 48px;
        margin-bottom: 10px;
    }
    
    .empty-state-text {
        font-size: 18px;
    }
    
    .toolbar {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 8px;
    }
    
    .tool-button {
        padding: 8px 16px;
        background: white;
        border: 2px solid #ddd;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.3s;
        font-size: 0.9em;
    }
    
    .tool-button:hover {
        border-color: #667eea;
        background: #f5f5ff;
    }
    
    .tool-button.active {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-color: #667eea;
    }
    
    .layer-item {
        padding: 10px;
        background: #f8f9fa;
        border-radius: 6px;
        margin-bottom: 8px;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .layer-visibility {
        width: 20px;
        height: 20px;
    }
    
    .layer-name {
        flex: 1;
        font-size: 0.9em;
    }
    
    .layer-delete {
        padding: 4px 8px;
        background: #dc3545;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.8em;
    }
    
    .preset-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 8px;
    }
    
    .preset-button {
        padding: 8px;
        font-size: 0.85em;
        background: #f8f9fa;
        color: #333;
        border: 2px solid #ddd;
    }
    
    .preset-button:hover {
        background: #e9ecef;
        border-color: #667eea;
    }
    
    .color-palette {
        display: flex;
        gap: 5px;
        flex-wrap: wrap;
        margin-top: 10px;
    }
    
    .color-preset {
        width: 30px;
        height: 30px;
        border-radius: 5px;
        cursor: pointer;
        border: 2px solid transparent;
        transition: all 0.3s;
    }
    
    .color-preset:hover {
        transform: scale(1.1);
        border-color: #333;
    }
    
    /* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ */
    .controls-panel::-webkit-scrollbar {
        width: 8px;
    }
    
    .controls-panel::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 10px;
    }
    
    .controls-panel::-webkit-scrollbar-thumb {
        background: #888;
        border-radius: 10px;
    }
    
    .controls-panel::-webkit-scrollbar-thumb:hover {
        background: #555;
    }
    
    /* ë°˜ì‘í˜• ë””ìì¸ */
    @media (max-width: 1024px) {
        .workspace {
            grid-template-columns: 1fr;
        }
        
        .controls-panel {
            max-height: none;
        }
    }
</style>
```

</head>
<body>
    <div class="main-container">
        <div class="header">
            <h1>Advanced Op-Art Generator</h1>
            <div class="subtitle">ì¸í„°ë™í‹°ë¸Œ ì˜µì•„íŠ¸ íŒ¨í„´ ìƒì„±ê¸°</div>
        </div>

```
    <div class="workspace">
        <div class="controls-panel">
            <!-- íŒŒì¼ ì…ë ¥ ì„¹ì…˜ -->
            <div class="control-section">
                <div class="section-title">
                    <div class="section-icon">ğŸ“</div>
                    ì´ë¯¸ì§€ ì—…ë¡œë“œ
                </div>
                <div class="control-group">
                    <input type="file" id="fileInput" accept="image/*">
                </div>
            </div>
            
            <!-- íŒ¨í„´ ì„ íƒ ì„¹ì…˜ -->
            <div class="control-section">
                <div class="section-title">
                    <div class="section-icon">ğŸ¨</div>
                    íŒ¨í„´ ì„¤ì •
                </div>
                <div class="control-group">
                    <label for="patternSelect">íŒ¨í„´ ì¢…ë¥˜</label>
                    <select id="patternSelect">
                        <optgroup label="ê¸°ë³¸ íŒ¨í„´">
                            <option value="radial">ë°©ì‚¬í˜• ì„ </option>
                            <option value="concentric">ë™ì‹¬ì›</option>
                            <option value="grid">ê²©ì ì™œê³¡</option>
                            <option value="wave">ë¬¼ê²° íŒ¨í„´</option>
                            <option value="spiral">ë‚˜ì„ í˜•</option>
                            <option value="moire">ëª¨ì•„ë ˆ</option>
                        </optgroup>
                        <optgroup label="ê³ ê¸‰ íŒ¨í„´">
                            <option value="checkerboard">ì²´ì»¤ë³´ë“œ ì™œê³¡</option>
                            <option value="hexagon">ìœ¡ê°í˜• ê·¸ë¦¬ë“œ</option>
                            <option value="voronoi">ë³´ë¡œë…¸ì´ ë‹¤ì´ì–´ê·¸ë¨</option>
                            <option value="fractal">í”„ë™íƒˆ íŒ¨í„´</option>
                            <option value="noise">í„ë¦° ë…¸ì´ì¦ˆ</option>
                            <option value="halftone">í•˜í”„í†¤</option>
                        </optgroup>
                        <optgroup label="ë³µí•© íŒ¨í„´">
                            <option value="hybrid1">ë°©ì‚¬í˜• + ë™ì‹¬ì›</option>
                            <option value="hybrid2">ê²©ì + ë¬¼ê²°</option>
                            <option value="hybrid3">ë‚˜ì„  + ëª¨ì•„ë ˆ</option>
                        </optgroup>
                    </select>
                </div>
                
                <div class="control-group">
                    <label>í”„ë¦¬ì…‹</label>
                    <div class="preset-grid">
                        <button class="preset-button" onclick="applyPreset('classic')">í´ë˜ì‹</button>
                        <button class="preset-button" onclick="applyPreset('psychedelic')">ì‚¬ì´í‚¤ë¸ë¦­</button>
                        <button class="preset-button" onclick="applyPreset('minimal')">ë¯¸ë‹ˆë©€</button>
                        <button class="preset-button" onclick="applyPreset('intense')">ì¸í…ìŠ¤</button>
                    </div>
                </div>
            </div>
            
            <!-- íŒ¨í„´ íŒŒë¼ë¯¸í„° ì„¹ì…˜ -->
            <div class="control-section">
                <div class="section-title">
                    <div class="section-icon">âš™ï¸</div>
                    íŒ¨í„´ íŒŒë¼ë¯¸í„°
                </div>
                
                <div class="control-group">
                    <label for="densitySlider">ë°€ë„</label>
                    <div class="slider-container">
                        <input type="range" id="densitySlider" min="5" max="150" value="50">
                        <span class="slider-value" id="densityValue">50</span>
                    </div>
                </div>
                
                <div class="control-group">
                    <label for="amplitudeSlider">ì§„í­</label>
                    <div class="slider-container">
                        <input type="range" id="amplitudeSlider" min="0" max="100" value="20">
                        <span class="slider-value" id="amplitudeValue">20</span>
                    </div>
                </div>
                
                <div class="control-group">
                    <label for="frequencySlider">ì£¼íŒŒìˆ˜</label>
                    <div class="slider-container">
                        <input type="range" id="frequencySlider" min="1" max="50" value="10">
                        <span class="slider-value" id="frequencyValue">10</span>
                    </div>
                </div>
                
                <div class="control-group">
                    <label for="rotationSlider">íšŒì „</label>
                    <div class="slider-container">
                        <input type="range" id="rotationSlider" min="0" max="360" value="0">
                        <span class="slider-value" id="rotationValue">0Â°</span>
                    </div>
                </div>
                
                <div class="control-group">
                    <label for="distortionSlider">ì™œê³¡</label>
                    <div class="slider-container">
                        <input type="range" id="distortionSlider" min="0" max="100" value="0">
                        <span class="slider-value" id="distortionValue">0</span>
                    </div>
                </div>
            </div>
            
            <!-- ìƒ‰ìƒ ì„¤ì • ì„¹ì…˜ -->
            <div class="control-section">
                <div class="section-title">
                    <div class="section-icon">ğŸ¨</div>
                    ìƒ‰ìƒ ì„¤ì •
                </div>
                
                <div class="control-group">
                    <label for="colorMode">ìƒ‰ìƒ ëª¨ë“œ</label>
                    <select id="colorMode">
                        <option value="single">ë‹¨ìƒ‰</option>
                        <option value="gradient">ê·¸ë¼ë””ì–¸íŠ¸</option>
                        <option value="rainbow">ë¬´ì§€ê°œ</option>
                        <option value="random">ëœë¤</option>
                        <option value="complementary">ë³´ìƒ‰</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label for="colorPicker1">ì£¼ ìƒ‰ìƒ</label>
                    <input type="color" id="colorPicker1" value="#000000">
                </div>
                
                <div class="control-group" id="secondColorGroup" style="display: none;">
                    <label for="colorPicker2">ë³´ì¡° ìƒ‰ìƒ</label>
                    <input type="color" id="colorPicker2" value="#ffffff">
                </div>
                
                <div class="control-group">
                    <label>ìƒ‰ìƒ í”„ë¦¬ì…‹</label>
                    <div class="color-palette">
                        <div class="color-preset" style="background: #000000" onclick="setColor('#000000')"></div>
                        <div class="color-preset" style="background: #ffffff; border: 1px solid #ddd" onclick="setColor('#ffffff')"></div>
                        <div class="color-preset" style="background: #ff0000" onclick="setColor('#ff0000')"></div>
                        <div class="color-preset" style="background: #00ff00" onclick="setColor('#00ff00')"></div>
                        <div class="color-preset" style="background: #0000ff" onclick="setColor('#0000ff')"></div>
                        <div class="color-preset" style="background: #ff00ff" onclick="setColor('#ff00ff')"></div>
                        <div class="color-preset" style="background: #ffff00" onclick="setColor('#ffff00')"></div>
                        <div class="color-preset" style="background: #00ffff" onclick="setColor('#00ffff')"></div>
                    </div>
                </div>
            </div>
            
            <!-- ìŠ¤íƒ€ì¼ ì˜µì…˜ ì„¹ì…˜ -->
            <div class="control-section">
                <div class="section-title">
                    <div class="section-icon">âœ¨</div>
                    ìŠ¤íƒ€ì¼ ì˜µì…˜
                </div>
                
                <div class="control-group">
                    <label for="strokeWeightSlider">ì„  êµµê¸°</label>
                    <div class="slider-container">
                        <input type="range" id="strokeWeightSlider" min="0.5" max="10" value="1" step="0.5">
                        <span class="slider-value" id="strokeWeightValue">1</span>
                    </div>
                </div>
                
                <div class="control-group">
                    <label for="opacitySlider">íˆ¬ëª…ë„</label>
                    <div class="slider-container">
                        <input type="range" id="opacitySlider" min="0" max="100" value="100">
                        <span class="slider-value" id="opacityValue">100%</span>
                    </div>
                </div>
                
                <div class="control-group">
                    <div class="checkbox-label">
                        <input type="checkbox" id="fillCheck">
                        <label for="fillCheck">ë©´ ì±„ìš°ê¸°</label>
                    </div>
                    
                    <div class="checkbox-label">
                        <input type="checkbox" id="shadowCheck">
                        <label for="shadowCheck">ê·¸ë¦¼ì íš¨ê³¼</label>
                    </div>
                    
                    <div class="checkbox-label">
                        <input type="checkbox" id="glowCheck">
                        <label for="glowCheck">ë°œê´‘ íš¨ê³¼</label>
                    </div>
                    
                    <div class="checkbox-label">
                        <input type="checkbox" id="invertCheck">
                        <label for="invertCheck">ë°˜ì „ ë§ˆìŠ¤í¬</label>
                    </div>
                </div>
            </div>
            
            <!-- ì• ë‹ˆë©”ì´ì…˜ ì„¹ì…˜ -->
            <div class="control-section">
                <div class="section-title">
                    <div class="section-icon">â–¶ï¸</div>
                    ì• ë‹ˆë©”ì´ì…˜
                </div>
                
                <div class="control-group">
                    <div class="checkbox-label">
                        <input type="checkbox" id="animateCheck">
                        <label for="animateCheck">ì• ë‹ˆë©”ì´ì…˜ í™œì„±í™”</label>
                    </div>
                </div>
                
                <div class="control-group">
                    <label for="animSpeedSlider">ì†ë„</label>
                    <div class="slider-container">
                        <input type="range" id="animSpeedSlider" min="0.1" max="5" value="1" step="0.1">
                        <span class="slider-value" id="animSpeedValue">1x</span>
                    </div>
                </div>
                
                <div class="control-group">
                    <label for="animType">ì• ë‹ˆë©”ì´ì…˜ íƒ€ì…</label>
                    <select id="animType">
                        <option value="rotate">íšŒì „</option>
                        <option value="pulse">í„ìŠ¤</option>
                        <option value="wave">ì›¨ì´ë¸Œ</option>
                        <option value="morph">ëª¨í•‘</option>
                        <option value="zoom">ì¤Œ</option>
                    </select>
                </div>
            </div>
            
            <!-- ë ˆì´ì–´ ê´€ë¦¬ ì„¹ì…˜ -->
            <div class="control-section">
                <div class="section-title">
                    <div class="section-icon">ğŸ“š</div>
                    ë ˆì´ì–´ ê´€ë¦¬
                </div>
                
                <div class="control-group">
                    <button onclick="addLayer()" class="primary-button">ìƒˆ ë ˆì´ì–´ ì¶”ê°€</button>
                </div>
                
                <div id="layerList">
                    <div class="layer-item">
                        <input type="checkbox" class="layer-visibility" checked>
                        <span class="layer-name">ë ˆì´ì–´ 1</span>
                        <button class="layer-delete">ì‚­ì œ</button>
                    </div>
                </div>
            </div>
            
            <!-- ì•¡ì…˜ ë²„íŠ¼ ì„¹ì…˜ -->
            <div class="control-section">
                <div class="section-title">
                    <div class="section-icon">ğŸ’¾</div>
                    ë‚´ë³´ë‚´ê¸°
                </div>
                
                <div class="button-group">
                    <button id="downloadBtn" class="primary-button" disabled>PNG ë‹¤ìš´ë¡œë“œ</button>
                    <button id="downloadSVGBtn" disabled>SVG ë‚´ë³´ë‚´ê¸°</button>
                    <button id="downloadGIFBtn" disabled>GIF ì €ì¥</button>
                    <button id="resetBtn" class="secondary-button">ì´ˆê¸°í™”</button>
                    <button id="randomBtn">ëœë¤ ìƒì„±</button>
                    <button id="clearBtn" class="danger-button">ì „ì²´ ì‚­ì œ</button>
                </div>
            </div>
        </div>
        
        <div class="canvas-area">
            <div class="toolbar">
                <button class="tool-button active" data-tool="generate">ìƒì„±</button>
                <button class="tool-button" data-tool="brush">ë¸ŒëŸ¬ì‹œ</button>
                <button class="tool-button" data-tool="eraser">ì§€ìš°ê°œ</button>
                <button class="tool-button" data-tool="select">ì„ íƒ</button>
                <button class="tool-button" data-tool="move">ì´ë™</button>
                <button class="tool-button" data-tool="zoom">í™•ëŒ€/ì¶•ì†Œ</button>
            </div>
            
            <div id="canvas-container">
                <div class="empty-state">
                    <div class="empty-state-icon">ğŸ¨</div>
                    <div class="empty-state-text">ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ì—¬ ì‹œì‘í•˜ì„¸ìš”</div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // ì „ì—­ ë³€ìˆ˜
    let currentTool = 'generate';
    let layers = [];
    let currentLayer = 0;
    let animationTime = 0;
    let isAnimating = false;
    let animSpeed = 1;
    let animType = 'rotate';
    
    // í”„ë¦¬ì…‹ ì„¤ì •
    const presets = {
        classic: {
            pattern: 'concentric',
            density: 30,
            amplitude: 15,
            frequency: 8,
            strokeWeight: 1,
            colorMode: 'single',
            color1: '#000000'
        },
        psychedelic: {
            pattern: 'spiral',
            density: 80,
            amplitude: 50,
            frequency: 25,
            strokeWeight: 2,
            colorMode: 'rainbow',
            color1: '#ff00ff'
        },
        minimal: {
            pattern: 'grid',
            density: 20,
            amplitude: 10,
            frequency: 5,
            strokeWeight: 0.5,
            colorMode: 'single',
            color1: '#333333'
        },
        intense: {
            pattern: 'moire',
            density: 100,
            amplitude: 30,
            frequency: 15,
            strokeWeight: 1.5,
            colorMode: 'gradient',
            color1: '#ff0000',
            color2: '#0000ff'
        }
    };
    
    // P5.js ìŠ¤ì¼€ì¹˜
    const sketch = (p) => {
        let img;
        let patternType = 'radial';
        let density = 50;
        let amplitude = 20;
        let frequency = 10;
        let rotation = 0;
        let distortion = 0;
        let strokeWeightVal = 1;
        let opacity = 100;
        let patternColor1, patternColor2;
        let colorMode = 'single';
        let fillEnabled = false;
        let shadowEnabled = false;
        let glowEnabled = false;
        let invertMask = false;
        let canvasCreated = false;
        let pg; // ì˜¤í”„ìŠ¤í¬ë¦° ê·¸ë˜í”½ìŠ¤
        
        p.setup = () => {
            p.noLoop();
            patternColor1 = p.color('#000000');
            patternColor2 = p.color('#ffffff');
        };
        
        p.draw = () => {
            if (!img) return;
            
            p.background(255);
            
            // ì• ë‹ˆë©”ì´ì…˜ ì‹œê°„ ì—…ë°ì´íŠ¸
            if (isAnimating) {
                animationTime += 0.016 * animSpeed; // 60fps ê¸°ì¤€
            }
            
            // ê° ë ˆì´ì–´ ê·¸ë¦¬ê¸°
            layers.forEach((layer, index) => {
                if (layer.visible) {
                    drawLayer(layer);
                }
            });
            
            // í˜„ì¬ ì‘ì—… ì¤‘ì¸ íŒ¨í„´ ê·¸ë¦¬ê¸°
            if (currentLayer === -1 || layers.length === 0) {
                drawPattern();
            }
        };
        
        function drawLayer(layer) {
            p.push();
            // ë ˆì´ì–´ë³„ ì„¤ì • ì ìš©
            p.pop();
        }
        
        function drawPattern() {
            p.push();
            
            if (rotation !== 0) {
                p.translate(p.width/2, p.height/2);
                p.rotate(p.radians(rotation));
                p.translate(-p.width/2, -p.height/2);
            }
            
            img.loadPixels();
            
            let centerX = p.width / 2;
            let centerY = p.height / 2;
            
            // ìƒ‰ìƒ ì„¤ì •
            let col = getPatternColor();
            if (opacity < 100) {
                col.setAlpha(p.map(opacity, 0, 100, 0, 255));
            }
            
            p.stroke(col);
            p.strokeWeight(strokeWeightVal);
            
            if (fillEnabled) {
                let fillCol = p.color(col.toString());
                fillCol.setAlpha(50);
                p.fill(fillCol);
            } else {
                p.noFill();
            }
            
            // ê·¸ë¦¼ì íš¨ê³¼
            if (shadowEnabled) {
                p.drawingContext.shadowBlur = 5;
                p.drawingContext.shadowColor = 'rgba(0,0,0,0.3)';
            }
            
            // ë°œê´‘ íš¨ê³¼
            if (glowEnabled) {
                p.drawingContext.shadowBlur = 10;
                p.drawingContext.shadowColor = col.toString();
            }
            
            // íŒ¨í„´ íƒ€ì…ì— ë”°ë¼ ê·¸ë¦¬ê¸°
            switch(patternType) {
                case 'radial':
                    drawRadialPattern(centerX, centerY);
                    break;
                case 'concentric':
                    drawConcentricPattern(centerX, centerY);
                    break;
                case 'grid':
                    drawGridPattern(centerX, centerY);
                    break;
                case 'wave':
                    drawWavePattern(centerX, centerY);
                    break;
                case 'spiral':
                    drawSpiralPattern(centerX, centerY);
                    break;
                case 'moire':
                    drawMoirePattern(centerX, centerY);
                    break;
                case 'checkerboard':
                    drawCheckerboardPattern(centerX, centerY);
                    break;
                case 'hexagon':
                    drawHexagonPattern(centerX, centerY);
                    break;
                case 'voronoi':
                    drawVoronoiPattern(centerX, centerY);
                    break;
                case 'fractal':
                    drawFractalPattern(centerX, centerY);
                    break;
                case 'noise':
                    drawNoisePattern(centerX, centerY);
                    break;
                case 'halftone':
                    drawHalftonePattern(centerX, centerY);
                    break;
                case 'hybrid1':
                    drawRadialPattern(centerX, centerY);
                    drawConcentricPattern(centerX, centerY);
                    break;
                case 'hybrid2':
                    drawGridPattern(centerX, centerY);
                    drawWavePattern(centerX, centerY);
                    break;
                case 'hybrid3':
                    drawSpiralPattern(centerX, centerY);
                    drawMoirePattern(centerX, centerY);
                    break;
            }
            
            // íš¨ê³¼ ì´ˆê¸°í™”
            p.drawingContext.shadowBlur = 0;
            p.drawingContext.shadowColor = 'transparent';
            
            p.pop();
        }
        
        function getPatternColor() {
            switch(colorMode) {
                case 'single':
                    return patternColor1;
                case 'gradient':
                    let t = (p.frameCount * 0.01) % 1;
                    return p.lerpColor(patternColor1, patternColor2, t);
                case 'rainbow':
                    let h = (p.frameCount * 2) % 360;
                    p.colorMode(p.HSB);
                    let col = p.color(h, 100, 100);
                    p.colorMode(p.RGB);
                    return col;
                case 'random':
                    return p.color(p.random(255), p.random(255), p.random(255));
                case 'complementary':
                    let base = patternColor1;
                    p.colorMode(p.HSB);
                    let hue = p.hue(base);
                    let complementHue = (hue + 180) % 360;
                    let comp = p.color(complementHue, p.saturation(base), p.brightness(base));
                    p.colorMode(p.RGB);
                    return (p.frameCount % 20 < 10) ? base : comp;
                default:
                    return patternColor1;
            }
        }
        
        function isInsideMask(x, y) {
            if (x < 0 || x >= img.width || y < 0 || y >= img.height) return false;
            let index = (p.floor(y) * img.width + p.floor(x)) * 4;
            let r = img.pixels[index];
            let g = img.pixels[index + 1];
            let b = img.pixels[index + 2];
            let alpha = img.pixels[index + 3];
            
            let isInside = alpha > 128 && (r < 250 || g < 250 || b < 250);
            
            return invertMask ? !isInside : isInside;
        }
        
        function applyAnimation(x, y, time) {
            switch(animType) {
                case 'rotate':
                    let angle = p.atan2(y - p.height/2, x - p.width/2);
                    return {
                        x: x + p.cos(angle + time) * amplitude * 0.5,
                        y: y + p.sin(angle + time) * amplitude * 0.5
                    };
                case 'pulse':
                    let dist = p.dist(x, y, p.width/2, p.height/2);
                    let scale = 1 + p.sin(time * 2 + dist * 0.01) * 0.1;
                    return {
                        x: p.width/2 + (x - p.width/2) * scale,
                        y: p.height/2 + (y - p.height/2) * scale
                    };
                case 'wave':
                    return {
                        x: x + p.sin(y * 0.05 + time * 2) * amplitude,
                        y: y + p.cos(x * 0.05 + time * 2) * amplitude
                    };
                case 'morph':
                    return {
                        x: x + p.noise(x * 0.01, y * 0.01, time) * amplitude * 2 - amplitude,
                        y: y + p.noise(x * 0.01 + 100, y * 0.01, time) * amplitude * 2 - amplitude
                    };
                case 'zoom':
                    let zoomScale = 1 + p.sin(time) * 0.2;
                    return {
                        x: p.width/2 + (x - p.width/2) * zoomScale,
                        y: p.height/2 + (y - p.height/2) * zoomScale
                    };
                default:
                    return { x, y };
            }
        }
        
        // ê¸°ë³¸ íŒ¨í„´ í•¨ìˆ˜ë“¤
        function drawRadialPattern(cx, cy) {
            let maxDist = p.dist(0, 0, p.width, p.height);
            let numLines = density;
            
            for (let i = 0; i < numLines; i++) {
                let angle = p.TWO_PI * i / numLines;
                
                // ì• ë‹ˆë©”ì´ì…˜ ì ìš©
                if (isAnimating) {
                    angle += animationTime * 0.5;
                }
                
                p.beginShape();
                for (let r = 0; r < maxDist; r += 2) {
                    let x = cx + p.cos(angle) * r;
                    let y = cy + p.sin(angle) * r;
                    
                    // ì™œê³¡ ì ìš©
                    if (distortion > 0) {
                        let distAmount = distortion * 0.1;
                        x += p.noise(x * 0.01, y * 0.01) * distAmount * 10 - distAmount * 5;
                        y += p.noise(x * 0.01 + 100, y * 0.01) * distAmount * 10 - distAmount * 5;
                    }
                    
                    // ì• ë‹ˆë©”ì´ì…˜ ì ìš©
                    if (isAnimating) {
                        let animated = applyAnimation(x, y, animationTime);
                        x = animated.x;
                        y = animated.y;
                    }
                    
                    if (isInsideMask(x, y)) {
                        p.vertex(x, y);
                    }
                }
                p.endShape();
            }
        }
        
        function drawConcentricPattern(cx, cy) {
            let maxDist = p.dist(0, 0, p.width, p.height) / 2;
            let spacing = p.map(density, 5, 150, 50, 3);
            
            for (let r = spacing; r < maxDist; r += spacing) {
                let variation = p.sin(r * frequency * 0.01) * amplitude;
                let actualRadius = r + variation;
                
                // ì• ë‹ˆë©”ì´ì…˜ ì ìš©
                if (isAnimating) {
                    actualRadius += p.sin(animationTime * 2) * 10;
                }
                
                p.beginShape();
                let steps = p.floor(actualRadius * p.TWO_PI / 2);
                for (let i = 0; i <= steps; i++) {
                    let angle = p.TWO_PI * i / steps;
                    
                    // ì• ë‹ˆë©”ì´ì…˜ ê°ë„ ì¡°ì •
                    if (isAnimating && animType === 'rotate') {
                        angle += animationTime;
                    }
                    
                    let x = cx + p.cos(angle) * actualRadius;
                    let y = cy + p.sin(angle) * actualRadius;
                    
                    // ì™œê³¡ ì ìš©
                    if (distortion > 0) {
                        let distAmount = distortion * 0.1;
                        x += p.sin(angle * frequency * 0.1) * distAmount * 5;
                        y += p.cos(angle * frequency * 0.1) * distAmount * 5;
                    }
                    
                    if (isInsideMask(x, y)) {
                        p.vertex(x, y);
                    }
                }
                p.endShape();
            }
        }
        
        function drawGridPattern(cx, cy) {
            let spacing = p.map(density, 5, 150, 60, 5);
            
            // ìˆ˜ì§ì„ 
            for (let x = 0; x < p.width; x += spacing) {
                p.beginShape();
                for (let y = 0; y < p.height; y += 1) {
                    if (isInsideMask(x, y)) {
                        let distFromCenter = p.dist(x, y, cx, cy);
                        let maxDist = p.dist(0, 0, p.width, p.height) / 2;
                        let warp = p.map(distFromCenter, 0, maxDist, 0, amplitude);
                        let offsetX = p.sin(y * frequency * 0.01) * warp;
                        
                        // ì™œê³¡ ì¶”ê°€
                        if (distortion > 0) {
                            offsetX += p.noise(x * 0.01, y * 0.01) * distortion * 0.5;
                        }
                        
                        // ì• ë‹ˆë©”ì´ì…˜
                        if (isAnimating) {
                            offsetX += p.sin(animationTime + y * 0.05) * 5;
                        }
                        
                        p.vertex(x + offsetX, y);
                    }
                }
                p.endShape();
            }
            
            // ìˆ˜í‰ì„ 
            for (let y = 0; y < p.height; y += spacing) {
                p.beginShape();
                for (let x = 0; x < p.width; x += 1) {
                    if (isInsideMask(x, y)) {
                        let distFromCenter = p.dist(x, y, cx, cy);
                        let maxDist = p.dist(0, 0, p.width, p.height) / 2;
                        let warp = p.map(distFromCenter, 0, maxDist, 0, amplitude);
                        let offsetY = p.sin(x * frequency * 0.01) * warp;
                        
                        // ì™œê³¡ ì¶”ê°€
                        if (distortion > 0) {
                            offsetY += p.noise(x * 0.01, y * 0.01) * distortion * 0.5;
                        }
                        
                        // ì• ë‹ˆë©”ì´ì…˜
                        if (isAnimating) {
                            offsetY += p.cos(animationTime + x * 0.05) * 5;
                        }
                        
                        p.vertex(x, y + offsetY);
                    }
                }
                p.endShape();
            }
        }
        
        function drawWavePattern(cx, cy) {
            let spacing = p.map(density, 5, 150, 30, 3);
            
            for (let y = 0; y < p.height; y += spacing) {
                p.beginShape();
                for (let x = 0; x < p.width; x += 1) {
                    if (isInsideMask(x, y)) {
                        let distFromCenter = p.dist(x, y, cx, cy);
                        let wave = p.sin(distFromCenter * frequency * 0.001 + x * 0.1) * amplitude;
                        
                        // ì• ë‹ˆë©”ì´ì…˜
                        if (isAnimating) {
                            wave += p.sin(animationTime * 2 + x * 0.05) * 10;
                        }
                        
                        // ì™œê³¡
                        if (distortion > 0) {
                            wave += p.noise(x * 0.01, y * 0.01, animationTime) * distortion;
                        }
                        
                        p.vertex(x, y + wave);
                    }
                }
                p.endShape();
            }
        }
        
        function drawSpiralPattern(cx, cy) {
            let maxDist = p.dist(0, 0, p.width, p.height);
            let numSpirals = p.map(density, 5, 150, 2, 20);
            
            for (let s = 0; s < numSpirals; s++) {
                let startAngle = p.TWO_PI * s / numSpirals;
                
                p.beginShape();
                for (let r = 0; r < maxDist; r += 2) {
                    let angle = startAngle + r * frequency * 0.01;
                    
                    // ì• ë‹ˆë©”ì´ì…˜
                    if (isAnimating) {
                        angle += animationTime;
                    }
                    
                    // ì§„í­ ì ìš©
                    let spiralR = r + p.sin(angle * 5) * amplitude * 0.5;
                    
                    let x = cx + p.cos(angle) * spiralR;
                    let y = cy + p.sin(angle) * spiralR;
                    
                    // ì™œê³¡
                    if (distortion > 0) {
                        x += p.random(-distortion * 0.5, distortion * 0.5);
                        y += p.random(-distortion * 0.5, distortion * 0.5);
                    }
                    
                    if (isInsideMask(x, y)) {
                        p.vertex(x, y);
                    }
                }
                p.endShape();
            }
        }
        
        function drawMoirePattern(cx, cy) {
            let spacing = p.map(density, 5, 150, 40, 5);
            
            // ì²« ë²ˆì§¸ ë ˆì´ì–´
            for (let i = 0; i < p.width; i += spacing) {
                p.beginShape();
                for (let y = 0; y < p.height; y += 1) {
                    if (isInsideMask(i, y)) {
                        let offsetX = p.sin(y * frequency * 0.01) * amplitude * 0.3;
                        
                        // ì• ë‹ˆë©”ì´ì…˜
                        if (isAnimating) {
                            offsetX += p.sin(animationTime + y * 0.02) * 3;
                        }
                        
                        p.vertex(i + offsetX, y);
                    }
                }
                p.endShape();
            }
            
            // ë‘ ë²ˆì§¸ ë ˆì´ì–´ - íšŒì „ëœ ì„ 
            p.push();
            p.translate(cx, cy);
            
            let rotAngle = p.PI / 12 + (distortion * 0.01);
            if (isAnimating) {
                rotAngle += p.sin(animationTime) * 0.1;
            }
            
            p.rotate(rotAngle);
            
            for (let i = -p.width; i < p.width; i += spacing) {
                p.beginShape();
                for (let y = -p.height; y < p.height; y += 1) {
                    let screenX = i;
                    let screenY = y;
                    
                    // ì—­ë³€í™˜
                    let worldX = p.cos(-rotAngle) * screenX - p.sin(-rotAngle) * screenY + cx;
                    let worldY = p.sin(-rotAngle) * screenX + p.cos(-rotAngle) * screenY + cy;
                    
                    if (isInsideMask(worldX, worldY)) {
                        let offsetX = p.sin(y * frequency * 0.01) * amplitude * 0.3;
                        p.vertex(screenX + offsetX, screenY);
                    }
                }
                p.endShape();
            }
            p.pop();
        }
        
        // ì¶”ê°€ ê³ ê¸‰ íŒ¨í„´ë“¤
        function drawCheckerboardPattern(cx, cy) {
            let size = p.map(density, 5, 150, 40, 5);
            
            for (let x = 0; x < p.width; x += size) {
                for (let y = 0; y < p.height; y += size) {
                    if ((x/size + y/size) % 2 === 0) {
                        // ì²´ì»¤ íŒ¨í„´ ê·¸ë¦¬ê¸°
                        for (let i = 0; i < size; i += 2) {
                            p.beginShape();
                            for (let j = 0; j < size; j++) {
                                let px = x + i;
                                let py = y + j;
                                
                                // ì™œê³¡ íš¨ê³¼
                                let dist = p.dist(px, py, cx, cy);
                                let warp = p.sin(dist * frequency * 0.01) * amplitude * 0.5;
                                px += warp;
                                
                                // ì• ë‹ˆë©”ì´ì…˜
                                if (isAnimating) {
                                    px += p.sin(animationTime + py * 0.01) * 5;
                                    py += p.cos(animationTime + px * 0.01) * 5;
                                }
                                
                                if (isInsideMask(px, py)) {
                                    p.vertex(px, py);
                                }
                            }
                            p.endShape();
                        }
                    }
                }
            }
        }
        
        function drawHexagonPattern(cx, cy) {
            let size = p.map(density, 5, 150, 50, 10);
            let h = size * p.sqrt(3);
            
            for (let y = 0; y < p.height + h; y += h * 3/4) {
                for (let x = 0; x < p.width + size; x += size * 2) {
                    let offsetX = (y / (h * 3/4)) % 2 === 1 ? size : 0;
                    drawHexagon(x + offsetX, y, size * 0.5);
                }
            }
        }
        
        function drawHexagon(cx, cy, radius) {
            p.beginShape();
            for (let i = 0; i < 6; i++) {
                let angle = p.TWO_PI * i / 6;
                let x = cx + p.cos(angle) * radius;
                let y = cy + p.sin(angle) * radius;
                
                // ì™œê³¡
                if (distortion > 0) {
                    x += p.noise(x * 0.01, y * 0.01) * distortion * 0.3;
                    y += p.noise(x * 0.01 + 100, y * 0.01) * distortion * 0.3;
                }
                
                // ì• ë‹ˆë©”ì´ì…˜
                if (isAnimating) {
                    let animated = applyAnimation(x, y, animationTime);
                    x = animated.x;
                    y = animated.y;
                }
                
                if (isInsideMask(x, y)) {
                    p.vertex(x, y);
                }
            }
            p.endShape(p.CLOSE);
        }
        
        function drawVoronoiPattern(cx, cy) {
            let numPoints = p.map(density, 5, 150, 10, 100);
            let points = [];
            
            // ëœë¤ í¬ì¸íŠ¸ ìƒì„±
            p.randomSeed(42); // ì¼ê´€ì„±ì„ ìœ„í•´ ì‹œë“œ ê³ ì •
            for (let i = 0; i < numPoints; i++) {
                points.push({
                    x: p.random(p.width),
                    y: p.random(p.height)
                });
            }
            
            // ë³´ë¡œë…¸ì´ ì…€ ê·¸ë¦¬ê¸°
            for (let point of points) {
                let px = point.x;
                let py = point.y;
                
                // ì• ë‹ˆë©”ì´ì…˜
                if (isAnimating) {
                    px += p.sin(animationTime + point.y * 0.01) * 10;
                    py += p.cos(animationTime + point.x * 0.01) * 10;
                }
                
                // ì…€ ê²½ê³„ ê·¸ë¦¬ê¸° (ê°„ë‹¨í•œ ê·¼ì‚¬)
                p.beginShape();
                for (let angle = 0; angle < p.TWO_PI; angle += 0.1) {
                    let r = 1000;
                    
                    // ê°€ì¥ ê°€ê¹Œìš´ ë‹¤ë¥¸ ì  ì°¾ê¸°
                    for (let other of points) {
                        if (other !== point) {
                            let d = p.dist(px, py, other.x, other.y) / 2;
                            if (d < r) r = d;
                        }
                    }
                    
                    let x = px + p.cos(angle) * r;
                    let y = py + p.sin(angle) * r;
                    
                    if (isInsideMask(x, y)) {
                        p.vertex(x, y);
                    }
                }
                p.endShape(p.CLOSE);
            }
        }
        
        function drawFractalPattern(cx, cy) {
            let depth = p.map(density, 5, 150, 2, 6);
            drawFractalRecursive(cx, cy, p.min(p.width, p.height) * 0.4, depth);
        }
        
        function drawFractalRecursive(x, y, size, depth) {
            if (depth <= 0 || size < 2) return;
            
            // ì¤‘ì‹¬ ì› ê·¸ë¦¬ê¸°
            p.beginShape();
            for (let angle = 0; angle < p.TWO_PI; angle += 0.1) {
                let px = x + p.cos(angle) * size;
                let py = y + p.sin(angle) * size;
                
                // ì• ë‹ˆë©”ì´ì…˜
                if (isAnimating) {
                    px += p.sin(animationTime + angle) * amplitude * 0.2;
                    py += p.cos(animationTime + angle) * amplitude * 0.2;
                }
                
                if (isInsideMask(px, py)) {
                    p.vertex(px, py);
                }
            }
            p.endShape();
            
            // ì¬ê·€ì ìœ¼ë¡œ ì‘ì€ ì›ë“¤ ê·¸ë¦¬ê¸°
            let numBranches = 6;
            for (let i = 0; i < numBranches; i++) {
                let angle = p.TWO_PI * i / numBranches;
                let newX = x + p.cos(angle) * size * 1.5;
                let newY = y + p.sin(angle) * size * 1.5;
                drawFractalRecursive(newX, newY, size * 0.4, depth - 1);
            }
        }
        
        function drawNoisePattern(cx, cy) {
            let scale = p.map(density, 5, 150, 0.02, 0.002);
            let spacing = 3;
            
            for (let x = 0; x < p.width; x += spacing) {
                p.beginShape();
                for (let y = 0; y < p.height; y += 1) {
                    if (isInsideMask(x, y)) {
                        let noiseVal = p.noise(x * scale, y * scale, animationTime * 0.5);
                        let offsetX = p.map(noiseVal, 0, 1, -amplitude, amplitude);
                        
                        p.vertex(x + offsetX, y);
                    }
                }
                p.endShape();
            }
        }
        
        function drawHalftonePattern(cx, cy) {
            let dotSize = p.map(density, 5, 150, 20, 3);
            
            for (let x = 0; x < p.width; x += dotSize) {
                for (let y = 0; y < p.height; y += dotSize) {
                    if (isInsideMask(x, y)) {
                        // ì´ë¯¸ì§€ ë°ê¸° ê¸°ë°˜ ë„íŠ¸ í¬ê¸°
                        let index = (p.floor(y) * img.width + p.floor(x)) * 4;
                        let brightness = (img.pixels[index] + img.pixels[index+1] + img.pixels[index+2]) / 3;
                        let size = p.map(brightness, 0, 255, dotSize, 0);
                        
                        // ì• ë‹ˆë©”ì´ì…˜
                        if (isAnimating) {
                            size *= 1 + p.sin(animationTime * 2 + x * 0.01 + y * 0.01) * 0.3;
                        }
                        
                        if (size > 0.5) {
                            p.beginShape();
                            for (let angle = 0; angle < p.TWO_PI; angle += 0.5) {
                                let px = x + p.cos(angle) * size * 0.5;
                                let py = y + p.sin(angle) * size * 0.5;
                                p.vertex(px, py);
                            }
                            p.endShape(p.CLOSE);
                        }
                    }
                }
            }
        }
        
        // UI ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ë“¤
        window.updatePattern = (type) => {
            patternType = type;
            if (img) p.redraw();
        };
        
        window.updateDensity = (val) => {
            density = val;
            if (img) p.redraw();
        };
        
        window.updateAmplitude = (val) => {
            amplitude = val;
            if (img) p.redraw();
        };
        
        window.updateFrequency = (val) => {
            frequency = val;
            if (img) p.redraw();
        };
        
        window.updateRotation = (val) => {
            rotation = val;
            if (img) p.redraw();
        };
        
        window.updateDistortion = (val) => {
            distortion = val;
            if (img) p.redraw();
        };
        
        window.updateStrokeWeight = (val) => {
            strokeWeightVal = val;
            if (img) p.redraw();
        };
        
        window.updateOpacity = (val) => {
            opacity = val;
            if (img) p.redraw();
        };
        
        window.updateColorMode = (mode) => {
            colorMode = mode;
            if (img) p.redraw();
        };
        
        window.updateColor1 = (color) => {
            patternColor1 = p.color(color);
            if (img) p.redraw();
        };
        
        window.updateColor2 = (color) => {
            patternColor2 = p.color(color);
            if (img) p.redraw();
        };
        
        window.updateFillEnabled = (enabled) => {
            fillEnabled = enabled;
            if (img) p.redraw();
        };
        
        window.updateShadowEnabled = (enabled) => {
            shadowEnabled = enabled;
            if (img) p.redraw();
        };
        
        window.updateGlowEnabled = (enabled) => {
            glowEnabled = enabled;
            if (img) p.redraw();
        };
        
        window.updateInvertMask = (enabled) => {
            invertMask = enabled;
            if (img) p.redraw();
        };
        
        window.setImage = (loadedImg) => {
            img = loadedImg;
            
            if (!canvasCreated) {
                let canvas = p.createCanvas(img.width, img.height);
                canvas.parent('canvas-container');
                document.querySelector('.empty-state').style.display = 'none';
                canvasCreated = true;
            } else {
                p.resizeCanvas(img.width, img.height);
            }
            
            p.redraw();
        };
        
        window.startAnimation = () => {
            if (isAnimating) {
                p.noLoop();
            } else {
                p.loop();
            }
            isAnimating = !isAnimating;
        };
        
        window.updateAnimSpeed = (speed) => {
            animSpeed = speed;
        };
        
        window.updateAnimType = (type) => {
            animType = type;
        };
        
        window.redrawCanvas = () => {
            if (img) p.redraw();
        };
        
        window.downloadCanvas = () => {
            p.saveCanvas('op-art', 'png');
        };
        
        window.downloadSVG = () => {
            // SVG ë‚´ë³´ë‚´ê¸°ëŠ” ë³„ë„ êµ¬í˜„ í•„ìš”
            alert('SVG ë‚´ë³´ë‚´ê¸°ëŠ” ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.');
        };
        
        window.downloadGIF = () => {
            // GIF ë‚´ë³´ë‚´ê¸°ëŠ” ë³„ë„ êµ¬í˜„ í•„ìš”
            alert('GIF ì €ì¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.');
        };
        
        window.resetCanvas = () => {
            // ëª¨ë“  ì„¤ì • ì´ˆê¸°í™”
            density = 50;
            amplitude = 20;
            frequency = 10;
            rotation = 0;
            distortion = 0;
            strokeWeightVal = 1;
            opacity = 100;
            patternType = 'radial';
            colorMode = 'single';
            fillEnabled = false;
            shadowEnabled = false;
            glowEnabled = false;
            invertMask = false;
            isAnimating = false;
            animationTime = 0;
            
            // UI ì—…ë°ì´íŠ¸
            document.getElementById('patternSelect').value = 'radial';
            document.getElementById('densitySlider').value = 50;
            document.getElementById('amplitudeSlider').value = 20;
            document.getElementById('frequencySlider').value = 10;
            document.getElementById('rotationSlider').value = 0;
            document.getElementById('distortionSlider').value = 0;
            document.getElementById('strokeWeightSlider').value = 1;
            document.getElementById('opacitySlider').value = 100;
            document.getElementById('colorMode').value = 'single';
            document.getElementById('fillCheck').checked = false;
            document.getElementById('shadowCheck').checked = false;
            document.getElementById('glowCheck').checked = false;
            document.getElementById('invertCheck').checked = false;
            document.getElementById('animateCheck').checked = false;
            
            updateSliderValues();
            
            if (img) p.redraw();
        };
        
        window.clearCanvas = () => {
            p.background(255);
            img = null;
            document.querySelector('.empty-state').style.display = 'block';
            document.getElementById('downloadBtn').disabled = true;
            document.getElementById('downloadSVGBtn').disabled = true;
            document.getElementById('downloadGIFBtn').disabled = true;
        };
        
        window.generateRandom = () => {
            // ëœë¤ ì„¤ì • ìƒì„±
            const patterns = ['radial', 'concentric', 'grid', 'wave', 'spiral', 'moire', 
                            'checkerboard', 'hexagon', 'voronoi', 'fractal', 'noise', 'halftone'];
            patternType = patterns[Math.floor(Math.random() * patterns.length)];
            density = Math.floor(Math.random() * 100) + 10;
            amplitude = Math.floor(Math.random() * 80);
            frequency = Math.floor(Math.random() * 40) + 1;
            rotation = Math.floor(Math.random() * 360);
            distortion = Math.floor(Math.random() * 50);
            strokeWeightVal = Math.random() * 3 + 0.5;
            opacity = Math.floor(Math.random() * 50) + 50;
            
            // ìƒ‰ìƒ ëœë¤
            const colorModes = ['single', 'gradient', 'rainbow', 'complementary'];
            colorMode = colorModes[Math.floor(Math.random() * colorModes.length)];
            
            let randomColor = () => '#' + Math.floor(Math.random()*16777215).toString(16);
            patternColor1 = p.color(randomColor());
            if (colorMode === 'gradient' || colorMode === 'complementary') {
                patternColor2 = p.color(randomColor());
            }
            
            // íš¨ê³¼ ëœë¤
            fillEnabled = Math.random() > 0.7;
            shadowEnabled = Math.random() > 0.8;
            glowEnabled = Math.random() > 0.8;
            invertMask = Math.random() > 0.9;
            
            // UI ì—…ë°ì´íŠ¸
            document.getElementById('patternSelect').value = patternType;
            document.getElementById('densitySlider').value = density;
            document.getElementById('amplitudeSlider').value = amplitude;
            document.getElementById('frequencySlider').value = frequency;
            document.getElementById('rotationSlider').value = rotation;
            document.getElementById('distortionSlider').value = distortion;
            document.getElementById('strokeWeightSlider').value = strokeWeightVal;
            document.getElementById('opacitySlider').value = opacity;
            document.getElementById('colorMode').value = colorMode;
            document.getElementById('colorPicker1').value = '#' + patternColor1.toString().substring(1, 7);
            if (colorMode === 'gradient' || colorMode === 'complementary') {
                document.getElementById('colorPicker2').value = '#' + patternColor2.toString().substring(1, 7);
                document.getElementById('secondColorGroup').style.display = 'block';
            }
            document.getElementById('fillCheck').checked = fillEnabled;
            document.getElementById('shadowCheck').checked = shadowEnabled;
            document.getElementById('glowCheck').checked = glowEnabled;
            document.getElementById('invertCheck').checked = invertMask;
            
            updateSliderValues();
            
            if (img) p.redraw();
        };
    };
    
    // P5 ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
    let myp5 = new p5(sketch);
    
    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë“¤
    document.getElementById('fileInput').addEventListener('change', function(e) {
        let file = e.target.files[0];
        if (file) {
            let reader = new FileReader();
            reader.onload = function(event) {
                let img = new Image();
                img.onload = function() {
                    let p5img = myp5.createImage(img.width, img.height);
                    p5img.drawingContext.drawImage(img, 0, 0);
                    window.setImage(p5img);
                    
                    document.getElementById('downloadBtn').disabled = false;
                    document.getElementById('downloadSVGBtn').disabled = false;
                    document.getElementById('downloadGIFBtn').disabled = false;
                };
                img.src = event.target.result;
            };
            reader.readAsDataURL(file);
        }
    });
    
    document.getElementById('patternSelect').addEventListener('change', (e) => {
        window.updatePattern(e.target.value);
    });
    
    document.getElementById('densitySlider').addEventListener('input', (e) => {
        window.updateDensity(parseInt(e.target.value));
        document.getElementById('densityValue').textContent = e.target.value;
    });
    
    document.getElementById('amplitudeSlider').addEventListener('input', (e) => {
        window.updateAmplitude(parseInt(e.target.value));
        document.getElementById('amplitudeValue').textContent = e.target.value;
    });
    
    document.getElementById('frequencySlider').addEventListener('input', (e) => {
        window.updateFrequency(parseInt(e.target.value));
        document.getElementById('frequencyValue').textContent = e.target.value;
    });
    
    document.getElementById('rotationSlider').addEventListener('input', (e) => {
        window.updateRotation(parseInt(e.target.value));
        document.getElementById('rotationValue').textContent = e.target.value + 'Â°';
    });
    
    document.getElementById('distortionSlider').addEventListener('input', (e) => {
        window.updateDistortion(parseInt(e.target.value));
        document.getElementById('distortionValue').textContent = e.target.value;
    });
    
    document.getElementById('strokeWeightSlider').addEventListener('input', (e) => {
        window.updateStrokeWeight(parseFloat(e.target.value));
        document.getElementById('strokeWeightValue').textContent = e.target.value;
    });
    
    document.getElementById('opacitySlider').addEventListener('input', (e) => {
        window.updateOpacity(parseInt(e.target.value));
        document.getElementById('opacityValue').textContent = e.target.value + '%';
    });
    
    document.getElementById('colorMode').addEventListener('change', (e) => {
        window.updateColorMode(e.target.value);
        let secondColorGroup = document.getElementById('secondColorGroup');
        if (e.target.value === 'gradient' || e.target.value === 'complementary') {
            secondColorGroup.style.display = 'block';
        } else {
            secondColorGroup.style.display = 'none';
        }
    });
    
    document.getElementById('colorPicker1').addEventListener('input', (e) => {
        window.updateColor1(e.target.value);
    });
    
    document.getElementById('colorPicker2').addEventListener('input', (e) => {
        window.updateColor2(e.target.value);
    });
    
    document.getElementById('fillCheck').addEventListener('change', (e) => {
        window.updateFillEnabled(e.target.checked);
    });
    
    document.getElementById('shadowCheck').addEventListener('change', (e) => {
        window.updateShadowEnabled(e.target.checked);
    });
    
    document.getElementById('glowCheck').addEventListener('change', (e) => {
        window.updateGlowEnabled(e.target.checked);
    });
    
    document.getElementById('invertCheck').addEventListener('change', (e) => {
        window.updateInvertMask(e.target.checked);
    });
    
    document.getElementById('animateCheck').addEventListener('change', (e) => {
        window.startAnimation();
    });
    
    document.getElementById('animSpeedSlider').addEventListener('input', (e) => {
        window.updateAnimSpeed(parseFloat(e.target.value));
        document.getElementById('animSpeedValue').textContent = e.target.value + 'x';
    });
    
    document.getElementById('animType').addEventListener('change', (e) => {
        window.updateAnimType(e.target.value);
    });
    
    // ë²„íŠ¼ ì´ë²¤íŠ¸
    document.getElementById('downloadBtn').addEventListener('click', window.downloadCanvas);
    document.getElementById('downloadSVGBtn').addEventListener('click', window.downloadSVG);
    document.getElementById('downloadGIFBtn').addEventListener('click', window.downloadGIF);
    document.getElementById('resetBtn').addEventListener('click', window.resetCanvas);
    document.getElementById('randomBtn').addEventListener('click', window.generateRandom);
    document.getElementById('clearBtn').addEventListener('click', window.clearCanvas);
    
    // íˆ´ë°” ë²„íŠ¼ë“¤
    document.querySelectorAll('.tool-button').forEach(btn => {
        btn.addEventListener('click', (e) => {
            document.querySelectorAll('.tool-button').forEach(b => b.classList.remove('active'));
            e.target.classList.add('active');
            currentTool = e.target.dataset.tool;
        });
    });
    
    // í—¬í¼ í•¨ìˆ˜ë“¤
    function updateSliderValues() {
        document.getElementById('densityValue').textContent = document.getElementById('densitySlider').value;
        document.getElementById('amplitudeValue').textContent = document.getElementById('amplitudeSlider').value;
        document.getElementById('frequencyValue').textContent = document.getElementById('frequencySlider').value;
        document.getElementById('rotationValue').textContent = document.getElementById('rotationSlider').value + 'Â°';
        document.getElementById('distortionValue').textContent = document.getElementById('distortionSlider').value;
        document.getElementById('strokeWeightValue').textContent = document.getElementById('strokeWeightSlider').value;
        document.getElementById('opacityValue').textContent = document.getElementById('opacitySlider').value + '%';
        document.getElementById('animSpeedValue').textContent = document.getElementById('animSpeedSlider').value + 'x';
    }
    
    function applyPreset(presetName) {
        const preset = presets[presetName];
        if (!preset) return;
        
        // í”„ë¦¬ì…‹ ì ìš©
        window.updatePattern(preset.pattern);
        window.updateDensity(preset.density);
        window.updateAmplitude(preset.amplitude);
        window.updateFrequency(preset.frequency);
        window.updateStrokeWeight(preset.strokeWeight);
        window.updateColorMode(preset.colorMode);
        window.updateColor1(preset.color1);
        if (preset.color2) {
            window.updateColor2(preset.color2);
        }
        
        // UI ì—…ë°ì´íŠ¸
        document.getElementById('patternSelect').value = preset.pattern;
        document.getElementById('densitySlider').value = preset.density;
        document.getElementById('amplitudeSlider').value = preset.amplitude;
        document.getElementById('frequencySlider').value = preset.frequency;
        document.getElementById('strokeWeightSlider').value = preset.strokeWeight;
        document.getElementById('colorMode').value = preset.colorMode;
        document.getElementById('colorPicker1').value = preset.color1;
        
        if (preset.colorMode === 'gradient' || preset.colorMode === 'complementary') {
            document.getElementById('secondColorGroup').style.display = 'block';
            if (preset.color2) {
                document.getElementById('colorPicker2').value = preset.color2;
            }
        } else {
            document.getElementById('secondColorGroup').style.display = 'none';
        }
        
        updateSliderValues();
    }
    
    function setColor(color) {
        document.getElementById('colorPicker1').value = color;
        window.updateColor1(color);
    }
    
    function addLayer() {
        // ë ˆì´ì–´ ì¶”ê°€ ë¡œì§
        let layerCount = layers.length + 1;
        let layerHtml = `
            <div class="layer-item">
                <input type="checkbox" class="layer-visibility" checked>
                <span class="layer-name">ë ˆì´ì–´ ${layerCount}</span>
                <button class="layer-delete" onclick="deleteLayer(${layerCount - 1})">ì‚­ì œ</button>
            </div>
        `;
        document.getElementById('layerList').insertAdjacentHTML('beforeend', layerHtml);
        
        layers.push({
            name: `ë ˆì´ì–´ ${layerCount}`,
            visible: true,
            pattern: 'radial',
            settings: {}
        });
    }
    
    function deleteLayer(index) {
        layers.splice(index, 1);
        updateLayerList();
    }
    
    function updateLayerList() {
        let html = '';
        layers.forEach((layer, index) => {
            html += `
                <div class="layer-item">
                    <input type="checkbox" class="layer-visibility" ${layer.visible ? 'checked' : ''}>
                    <span class="layer-name">${layer.name}</span>
                    <button class="layer-delete" onclick="deleteLayer(${index})">ì‚­ì œ</button>
                </div>
            `;
        });
        document.getElementById('layerList').innerHTML = html;
    }
</script>
```

</body>
</html>